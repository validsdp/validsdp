From mathcomp Require Import ssreflect.
Require Import Reals.
From Interval Require Import Interval_tactic.
From ValidSDP Require Import validsdp.

Local Open Scope R_scope.

Let p (x0 x1 x2 x3 x4 x5 : R) :=
  -4/1
  * (x3 * x3 * x0 + 8/1 * (x4 - x5) * (x1 - x2)
     - x3 * (16/1 * x0 + (x4 - 8/1) * x1 + (x5 - 8/1) * x2)).

Let b1 (x0 x1 x2 x3 x4 x5 : R) :=
  (x0 - 1) * (117547965573/100000000000 - x0).

Let b2 (x0 x1 x2 x3 x4 x5 : R) :=
  (x1 - 1) * (117547965573/100000000000 - x1).

Let b3 (x0 x1 x2 x3 x4 x5 : R) :=
  (x2 - 1) * (117547965573/100000000000 - x2).

Let b4 (x0 x1 x2 x3 x4 x5 : R) :=
  (x3 - 251952632905/100000000000) * (63504/10000 - x3).

Let b5 (x0 x1 x2 x3 x4 x5 : R) :=
  (x4 - 251952632905/100000000000) * (90601/10000 - x4).

Let b6 (x0 x1 x2 x3 x4 x5 : R) :=
  (x5 - 56644/10000) * (16/1 - x5).

Let sigma (x0 x1 x2 x3 x4 x5 : R) :=
  1018960489776087/68719476736.

Let sigma1 (x0 x1 x2 x3 x4 x5 : R) :=
  1786099025466243/68719476736 + 55625767234185/17179869184 * x0
  + 21167281686301/17179869184 * x1 + 90079536961545/68719476736 * x2
  + 236088769103389/34359738368 * x3 + 215499742731741/68719476736 * 
  x4 + 201618694766057/34359738368 * x5
  + 6452161688934297/137438953472 * x0^2
  + 51270209879561/68719476736 * x0 * x1
  + 1121002511953611/34359738368 * x1^2
  + 55693788982493/68719476736 * x0 * x2
  + 89134545441439/68719476736 * x1 * x2
  + 4499886388332891/137438953472 * x2^2
  + 355569899033949/68719476736 * x0 * x3
  + 122845894121339/17179869184 * x1 * x3
  + 536597965685747/68719476736 * x2 * x3
  + 1715814018807627/17179869184 * x3^2
  + 102292664064553/68719476736 * x0 * x4
  + 218019283976079/68719476736 * x1 * x4
  + 216284706622519/68719476736 * x2 * x4
  + 1181821167192721/68719476736 * x3 * x4
  + 1503716350737381/34359738368 * x4^2 + 34744888236587/8589934592 * 
  x0 * x5 + 431074458978141/68719476736 * x1 * x5
  + 479433533858475/68719476736 * x2 * x5
  + 7299777670652229/137438953472 * x3 * x5
  + 486347422355733/34359738368 * x4 * x5
  + 5548346147666211/68719476736 * x5^2.

Let sigma2 (x0 x1 x2 x3 x4 x5 : R) :=
  1744955584590211/68719476736 + 28995306795115/68719476736 * x0
  + 41893784884439/17179869184 * x1 + 7126916666823/17179869184 * x2
  + 45780985727251/68719476736 * x3 + 32015040730661/34359738368 * x4
  + 20992792115903/8589934592 * x5 + 4357835110456553/137438953472 * 
  x0^2 + -8382057319921/68719476736 * x0 * x1
  + 6415577734496725/137438953472 * x1^2
  + 19969666218159/68719476736 * x0 * x2
  + -9279001818441/68719476736 * x1 * x2
  + 4360037436293671/137438953472 * x2^2
  + 41339525251437/68719476736 * x0 * x3
  + -15373593047905/34359738368 * x1 * x3
  + 47273485507813/68719476736 * x2 * x3
  + 4725046757466227/137438953472 * x3^2 + 3535282091683/4294967296 * 
  x0 * x4 + -35790306254899/68719476736 * x1 * x4
  + 56138044422941/68719476736 * x2 * x4
  + 97753994925693/68719476736 * x3 * x4
  + 5182038473599957/137438953472 * x4^2
  + 64659769968611/34359738368 * x0 * x5
  + 23124678101141/34359738368 * x1 * x5
  + 155032682148115/68719476736 * x2 * x5
  + 83298880628821/34359738368 * x3 * x5
  + 261761427386175/68719476736 * x4 * x5
  + 7676905438266087/137438953472 * x5^2.

Let sigma3 (x0 x1 x2 x3 x4 x5 : R) :=
  3535334653183433/137438953472 + 26681791089877/34359738368 * x0
  + 62332690178459/68719476736 * x1 + 208997833643355/68719476736 * x2
  + 139615847586019/34359738368 * x3 + 188342378377473/68719476736 * 
  x4 + 293384696473565/68719476736 * x5
  + 4389443727770667/137438953472 * x0^2
  + 51458862861001/68719476736 * x0 * x1
  + 4443977366548371/137438953472 * x1^2
  + 14498698589855/34359738368 * x0 * x2
  + 40075443128443/68719476736 * x1 * x2
  + 3235156724469459/68719476736 * x2^2
  + 124945846700861/34359738368 * x0 * x3
  + 323169495372151/68719476736 * x1 * x3
  + 145327116739237/34359738368 * x2 * x3 + 289551341401669/4294967296 * 
  x3^2 + 138564695441019/68719476736 * x0 * x4
  + 22243318082031/8589934592 * x1 * x4
  + 91000212799235/68719476736 * x2 * x4
  + 369539731430811/34359738368 * x3 * x4
  + 2873718398587627/68719476736 * x4^2 + 33975868146727/8589934592 * 
  x0 * x5 + 165383423150009/34359738368 * x1 * x5
  + 73221087100379/17179869184 * x2 * x5
  + 4051368725036061/137438953472 * x3 * x5
  + 711856023849009/68719476736 * x4 * x5 + 162458174287169/2147483648 * 
  x5^2.

Let sigma4 (x0 x1 x2 x3 x4 x5 : R) :=
  1271234914494147/68719476736 + 18211117640733/17179869184 * x0
  + -137333083434247/68719476736 * x1 + -28349213884185/17179869184 * 
  x2 + -251768199949439/68719476736 * x3 + -94909569153797/68719476736 * 
  x4 + -83480004717723/68719476736 * x5 + 382114149761653/17179869184 * 
  x0^2 + -12150962836405/34359738368 * x0 * x1
  + 88987758406023/4294967296 * x1^2 + 16604021557/134217728 * x0 * x2
  + -108115220844817/68719476736 * x1 * x2
  + 1408941558664849/68719476736 * x2^2
  + -251133424365521/34359738368 * x0 * x3
  + -447185418534289/68719476736 * x1 * x3
  + -64310260398605/8589934592 * x2 * x3 + 288336058366971/34359738368 * 
  x3^2 + -17611469761419/68719476736 * x0 * x4
  + -48053551233111/68719476736 * x1 * x4
  + -57673369595953/34359738368 * x2 * x4
  + -249536935825197/68719476736 * x3 * x4
  + 247147132163287/34359738368 * x4^2
  + -40967729402809/68719476736 * x0 * x5
  + -41749195741773/34359738368 * x1 * x5
  + -22996620159385/68719476736 * x2 * x5
  + -307233882671003/68719476736 * x3 * x5
  + -55760862312555/17179869184 * x4 * x5
  + 103154942428935/34359738368 * x5^2.

Let sigma5 (x0 x1 x2 x3 x4 x5 : R) :=
  1171649031958135/68719476736 + -40599342360165/68719476736 * x0
  + -71632853379439/34359738368 * x1 + 12713569110165/8589934592 * x2
  + -152504132304381/68719476736 * x3 + -75960870754957/34359738368 * 
  x4 + -28274622175557/34359738368 * x5 + 313443249230723/17179869184 * 
  x0^2 + -9236170719009/8589934592 * x0 * x1
  + 1183132950114093/68719476736 * x1^2
  + -5300729936421/68719476736 * x0 * x2
  + -58532908840693/68719476736 * x1 * x2
  + 334672316791855/17179869184 * x2^2
  + -142391938133147/68719476736 * x0 * x3
  + -68506216914709/34359738368 * x1 * x3
  + -76437077967991/34359738368 * x2 * x3
  + 118350212514487/34359738368 * x3^2
  + -106395191901321/34359738368 * x0 * x4
  + -251866547532489/68719476736 * x1 * x4
  + -145881407691179/34359738368 * x2 * x4
  + -180936637030385/68719476736 * x3 * x4
  + 316227755198141/68719476736 * x4^2
  + -12752919526737/17179869184 * x0 * x5
  + -27221798890001/68719476736 * x1 * x5
  + -46740554392771/68719476736 * x2 * x5
  + -13343038079429/34359738368 * x3 * x5
  + -155004507669847/68719476736 * x4 * x5
  + 69876903248619/68719476736 * x5^2.

Let sigma6 (x0 x1 x2 x3 x4 x5 : R) :=
  67100431666897/8589934592 + -37137569305561/34359738368 * x0
  + 30061116914283/34359738368 * x1 + -70237361941139/68719476736 * x2
  + -8829688578599/17179869184 * x3 + -13936313960353/68719476736 * x4
  + -68070910632881/68719476736 * x5 + 565660054615833/68719476736 * 
  x0^2 + -18607966591049/34359738368 * x0 * x1
  + 320284333989493/34359738368 * x1^2
  + -21276193672947/17179869184 * x0 * x2
  + -3307180818575/17179869184 * x1 * x2 + 276713927635891/34359738368 * 
  x2^2 + -83862449236461/68719476736 * x0 * x3
  + 738094111125/4294967296 * x1 * x3 + 5601612420687/68719476736 * x2 * x3
  + 31322146243701/17179869184 * x3^2 + -22437091127/134217728 * x0 * x4
  + 12996697885627/68719476736 * x1 * x4
  + -28193262332865/34359738368 * x2 * x4
  + -20813155503151/68719476736 * x3 * x4 + 91144588557307/68719476736 * 
  x4^2 + -56838668957943/68719476736 * x0 * x5
  + -59255396699593/34359738368 * x1 * x5
  + -78962006674521/68719476736 * x2 * x5
  + -1848614912119/2147483648 * x3 * x5
  + -54396915848613/68719476736 * x4 * x5 + 40805754565229/68719476736 * 
  x5^2.

Lemma relax_pos (x0 x1 x2 x3 x4 x5 : R) :
  sigma x0 x1 x2 x3 x4 x5 * p x0 x1 x2 x3 x4 x5
  - sigma1 x0 x1 x2 x3 x4 x5 * b1 x0 x1 x2 x3 x4 x5
  - sigma2 x0 x1 x2 x3 x4 x5 * b2 x0 x1 x2 x3 x4 x5
  - sigma3 x0 x1 x2 x3 x4 x5 * b3 x0 x1 x2 x3 x4 x5
  - sigma4 x0 x1 x2 x3 x4 x5 * b4 x0 x1 x2 x3 x4 x5
  - sigma5 x0 x1 x2 x3 x4 x5 * b5 x0 x1 x2 x3 x4 x5
  - sigma6 x0 x1 x2 x3 x4 x5 * b6 x0 x1 x2 x3 x4 x5 - 1/100000000 >= 0.
Proof.
rewrite /sigma /p /sigma1 /b1 /sigma2 /b2 /sigma3 /b3 /sigma4 /b4 /sigma5 /b5 /sigma6 /b6.
do_sdp.
Qed.

Lemma sigma_pos (x0 x1 x2 x3 x4 x5 : R) : sigma x0 x1 x2 x3 x4 x5 > 0.
Proof. rewrite /sigma. interval. Qed.

Lemma sigma1_pos (x0 x1 x2 x3 x4 x5 : R) : sigma1 x0 x1 x2 x3 x4 x5 >= 0.
Proof. rewrite /sigma1. do_sdp. Qed.

Lemma sigma2_pos (x0 x1 x2 x3 x4 x5 : R) : sigma2 x0 x1 x2 x3 x4 x5 >= 0.
Proof. rewrite /sigma2. do_sdp. Qed.

Lemma sigma3_pos (x0 x1 x2 x3 x4 x5 : R) : sigma3 x0 x1 x2 x3 x4 x5 >= 0.
Proof. rewrite /sigma3. do_sdp. Qed.

Lemma sigma4_pos (x0 x1 x2 x3 x4 x5 : R) : sigma4 x0 x1 x2 x3 x4 x5 >= 0.
Proof. rewrite /sigma4. do_sdp. Qed.

Lemma sigma5_pos (x0 x1 x2 x3 x4 x5 : R) : sigma5 x0 x1 x2 x3 x4 x5 >= 0.
Proof. rewrite /sigma5. do_sdp. Qed.

Lemma sigma6_pos (x0 x1 x2 x3 x4 x5 : R) : sigma6 x0 x1 x2 x3 x4 x5 >= 0.
Proof. rewrite /sigma6. do_sdp. Qed.

Lemma var_bounds (x l u : R) : l <= x <= u -> (x - l) * (u - x) >= 0.
Proof.
move=> [Hl Hu].
apply Rle_ge.
by apply Interval_missing.Rmult_le_pos_pos; apply Fcore_Raux.Rle_0_minus.
Qed.

Lemma relax (x y z : R) : x >= 0 -> y >= 0 -> z - x * y > 0 -> z > 0.
Proof.
move=> HX Hy.
apply Rge_gt_trans, Rle_ge.
rewrite -{2}(Rminus_0_r z).
apply Rplus_le_compat_l, Ropp_le_contravar.
by apply Interval_missing.Rmult_le_pos_pos; apply Rge_le.
Qed.
  
Theorem p_pos (x0 x1 x2 x3 x4 x5 x6 : R) :
  1 <= x0 <= 117547965573 / 100000000000 ->
  1 <= x1 <= 117547965573 / 100000000000 ->
  1 <= x2 <= 117547965573 / 100000000000 ->
  251952632905 / 100000000000 <= x3 <= 63504 / 10000 ->
  251952632905 / 100000000000 <= x4 <= 90601 / 10000 ->
  56644 / 10000 <= x5 <= 16 ->
  p x0 x1 x2 x3 x4 x5 > 0.
Proof.
move=> H1 H2 H3 H4 H5 H6.
have Hb0 : b1 x0 x1 x2 x3 x4 x5 >= 0.
{ by apply var_bounds. }
have Hb1 : b2 x0 x1 x2 x3 x4 x5 >= 0.
{ by apply var_bounds. }
have Hb2 : b3 x0 x1 x2 x3 x4 x5 >= 0.
{ by apply var_bounds. }
have Hb3 : b4 x0 x1 x2 x3 x4 x5 >= 0.
{ by apply var_bounds. }
have Hb4 : b5 x0 x1 x2 x3 x4 x5 >= 0.
{ by apply var_bounds. }
have Hb5 : b6 x0 x1 x2 x3 x4 x5 >= 0.
{ by apply var_bounds; rewrite !Rcomplements.Rdiv_1. }
apply (Rmult_lt_reg_l (sigma x0 x1 x2 x3 x4 x5)); [by apply sigma_pos|].
rewrite Rmult_0_r.
apply (relax _ _ _ (sigma1_pos x0 x1 x2 x3 x4 x5) Hb0).
apply (relax _ _ _ (sigma2_pos x0 x1 x2 x3 x4 x5) Hb1).
apply (relax _ _ _ (sigma3_pos x0 x1 x2 x3 x4 x5) Hb2).
apply (relax _ _ _ (sigma4_pos x0 x1 x2 x3 x4 x5) Hb3).
apply (relax _ _ _ (sigma5_pos x0 x1 x2 x3 x4 x5) Hb4).
apply (relax _ _ _ (sigma6_pos x0 x1 x2 x3 x4 x5) Hb5).
move: (relax_pos x0 x1 x2 x3 x4 x5).
apply Rgt_ge_trans.
rewrite -{1}(Rplus_0_r (_ - _)).
apply (Rplus_gt_compat_l).
interval.
Qed.
