From mathcomp Require Import ssreflect.
Require Import Reals.
From Interval Require Import Interval_tactic.
From ValidSDP Require Import validsdp.

Local Open Scope R_scope.

Let p (x0 x1 x2 x3 x4 x5 : R) :=
  0
  - (x0 * x3 * (0 - x0 + x1 + x2 - x3 + x4 + x5)
     + x1 * x4 * (x0 - x1 + x2 + x3 - x4 + x5)
     + x2 * x5 * (x0 + x1 - x2 + x3 + x4 - x5) - x1 * x2 * x3 - x0 * x2 * x4
     - x0 * x1 * x5 - x3 * x4 * x5).

Let p' (x0 x1 x2 x3 x4 x5 : R) :=
  (0 - x1) * x2 - x0 * x3 + x1 * x4 + x2 * x5 - x4 * x5
  + x0 * (0 - x0 + x1 + x2 - x3 + x4 + x5).

Let b1 (x0 x1 x2 x3 x4 x5 : R) :=
  (x0 - 4) * (63504/10000 - x0).

Let b2 (x0 x1 x2 x3 x4 x5 : R) :=
  (x1 - 4) * (63504/10000 - x1).

Let b3 (x0 x1 x2 x3 x4 x5 : R) :=
  (x2 - 4) * (63504/10000 - x2).

Let b4 (x0 x1 x2 x3 x4 x5 : R) :=
  (x3 - 4) * (63504/10000 - x3).

Let b5 (x0 x1 x2 x3 x4 x5 : R) :=
  (x4 - 90601/10000) * (254016/10000 - x4).

Let b6 (x0 x1 x2 x3 x4 x5 : R) :=
  (x5 - 4) * (90601/10000 - x5).

Let sigma (x0 x1 x2 x3 x4 x5 : R) :=
  2910986317404263/18014398509481984.

Let sigma' (x0 x1 x2 x3 x4 x5 : R) :=
  6131564517655461/1125899906842624.

Let sigma1 (x0 x1 x2 x3 x4 x5 : R) :=
  1901024554252029/590295810358705651712
  + 2782986020841817/1237940039285380274899124224 * x0
  + 1388299972357635/1237940039285380274899124224 * x1
  + 4899845668973541/2475880078570760549798248448 * x2
  + 220199843712245/1237940039285380274899124224 * x3
  + 8603838568908649/2475880078570760549798248448 * x4
  + 782185021250383/618970019642690137449562112 * x5
  + 4611325835736201/144115188075855872 * x0^2
  + -5201643348717671/2475880078570760549798248448 * x0 * x1
  + 876202363880117/288230376151711744 * x1^2
  + -2535040341963435/618970019642690137449562112 * x0 * x2
  + 4177697107510399/288230376151711744 * x1 * x2
  + 2492990822320777/144115188075855872 * x2^2
  + 6104115084556469/1152921504606846976 * x0 * x3
  + 593080239129007/618970019642690137449562112 * x1 * x3
  + 1615014509519459/1237940039285380274899124224 * x2 * x3
  + 8199780924055765/36893488147419103232 * x3^2
  + -2204753855865627/618970019642690137449562112 * x0 * x4
  + 329642647134027/9671406556917033397649408 * x1 * x4
  + 154949833182579/4835703278458516698824704 * x2 * x4
  + 20418130836833/77371252455336267181195264 * x3 * x4
  + 3761720314740367/72057594037927936 * x4^2
  + -2305565438310105/309485009821345068724781056 * x0 * x5
  + 1928998669320915/618970019642690137449562112 * x1 * x5
  + -1342405381893031/309485009821345068724781056 * x2 * x5
  + -1657434327764369/1237940039285380274899124224 * x3 * x5
  + 5008060471153661/144115188075855872 * x4 * x5
  + 6671464633759547/1152921504606846976 * x5^2.

Let sigma2 (x0 x1 x2 x3 x4 x5 : R) :=
  7604098620700945/2361183241434822606848
  + 5455079828546213/2475880078570760549798248448 * x0
  + 377410415382065/618970019642690137449562112 * x1
  + -640367898656081/618970019642690137449562112 * x2
  + 263831314045965/618970019642690137449562112 * x3
  + 8599762736249595/2475880078570760549798248448 * x4
  + 1546068907835599/1237940039285380274899124224 * x5
  + 5379963163443353/288230376151711744 * x0^2
  + 2028445555701651/1237940039285380274899124224 * x0 * x1
  + 7228765093138665/2305843009213693952 * x1^2
  + 2210432819736083/1237940039285380274899124224 * x0 * x2
  + 5696229891461595/9223372036854775808 * x1 * x2
  + 621059271844743/18446744073709551616 * x2^2
  + 6318992314035095/288230376151711744 * x0 * x3
  + 4362781744660805/154742504910672534362390528 * x1 * x3
  + 1505734054543327/38685626227668133590597632 * x2 * x3
  + 928364396178721/144115188075855872 * x3^2
  + 5585395298180067/72057594037927936 * x0 * x4
  + 3521826884553593/1237940039285380274899124224 * x1 * x4
  + 1488215387883269/309485009821345068724781056 * x2 * x4
  + 3280706523035739/72057594037927936 * x3 * x4
  + 5799904501782067/72057594037927936 * x4^2
  + 8910227349893461/576460752303423488 * x0 * x5
  + 7649116338329721/618970019642690137449562112 * x1 * x5
  + -491251368888265/618970019642690137449562112 * x2 * x5
  + 327101298870631/36028797018963968 * x3 * x5
  + 4626028893817437/144115188075855872 * x4 * x5
  + 1846800612116159/576460752303423488 * x5^2.

Let sigma3 (x0 x1 x2 x3 x4 x5 : R) :=
  14851755175417/4611686018427387904
  + 1458549155248589/618970019642690137449562112 * x0
  + -1728497176075537/1237940039285380274899124224 * x1
  + 1405389040552349/1237940039285380274899124224 * x2
  + 68824903870137/38685626227668133590597632 * x3
  + 528331249458721/309485009821345068724781056 * x4
  + 917540578685505/309485009821345068724781056 * x5
  + 4181534235372069/144115188075855872 * x0^2
  + 3100158363035349/618970019642690137449562112 * x0 * x1
  + 6614336400043507/1152921504606846976 * x1^2
  + 3612495791367611/618970019642690137449562112 * x0 * x2
  + 6085705597382447/1152921504606846976 * x1 * x2
  + 5882717139103043/2305843009213693952 * x2^2
  + 4579943511959397/72057594037927936 * x0 * x3
  + 6960833564221719/1152921504606846976 * x1 * x3
  + 2057722174418695/576460752303423488 * x2 * x3
  + 5355744551487679/144115188075855872 * x3^2
  + 4779443625672125/288230376151711744 * x0 * x4
  + 2283680169055341/618970019642690137449562112 * x1 * x4
  + 7027792497363873/2475880078570760549798248448 * x2 * x4
  + 705615881614163/36028797018963968 * x3 * x4
  + 1821124010639153/576460752303423488 * x4^2
  + 2315843062219045/144115188075855872 * x0 * x5
  + 2430261310652181/154742504910672534362390528 * x1 * x5
  + 7845525515516873/2475880078570760549798248448 * x2 * x5
  + 1639805659829563/72057594037927936 * x3 * x5
  + 742123893872913/72057594037927936 * x4 * x5
  + 3625892022311861/288230376151711744 * x5^2.

Let sigma4 (x0 x1 x2 x3 x4 x5 : R) :=
  3802049241694389/1180591620717411303424
  + 5511367576187525/2475880078570760549798248448 * x0
  + 286186464084683/1237940039285380274899124224 * x1
  + 257536537817101/618970019642690137449562112 * x2
  + 2077744866099005/618970019642690137449562112 * x3
  + 5610058806515255/2475880078570760549798248448 * x4
  + 1575905993787421/618970019642690137449562112 * x5
  + 7617029862217641/72057594037927936 * x0^2
  + 2112185803372791/1237940039285380274899124224 * x0 * x1
  + 5385729320790443/9223372036854775808 * x1^2
  + 624106389644245/1237940039285380274899124224 * x0 * x2
  + 5749069145839589/4611686018427387904 * x1 * x2
  + 775082359270125/1152921504606846976 * x2^2
  + 10367301041213/70368744177664 * x0 * x3
  + 4634688766927171/154742504910672534362390528 * x1 * x3
  + 2278585032191949/77371252455336267181195264 * x2 * x3
  + 7487610938119303/144115188075855872 * x3^2
  + 8229320710627823/288230376151711744 * x0 * x4
  + 667559377906767/38685626227668133590597632 * x1 * x4
  + 1113706055864193/77371252455336267181195264 * x2 * x4
  + 3379674867781047/144115188075855872 * x3 * x4
  + 1016133518534565/144115188075855872 * x4^2
  + 6624558807653041/309485009821345068724781056 * x0 * x5
  + 1630502137545669/154742504910672534362390528 * x1 * x5
  + 2495510151701203/1237940039285380274899124224 * x2 * x5
  + 283176545012207/36028797018963968 * x3 * x5
  + 6526438179881673/288230376151711744 * x4 * x5
  + 3608580888537643/144115188075855872 * x5^2.

Let sigma5 (x0 x1 x2 x3 x4 x5 : R) :=
  8396558599841673/590295810358705651712
  + 1719145718880781/1237940039285380274899124224 * x0
  + -2350369586377073/18889465931478580854784 * x1
  + -6057578311296171/309485009821345068724781056 * x2
  + -4400234869749749/309485009821345068724781056 * x3
  + -4477538717867647/9444732965739290427392 * x4
  + -3565955867431125/2361183241434822606848 * x5
  + 2929177239380453/72057594037927936 * x0^2
  + -2350277291942879/1152921504606846976 * x0 * x1
  + 3953943484683415/576460752303423488 * x1^2
  + -5675942756384415/2305843009213693952 * x0 * x2
  + 2386082136682233/144115188075855872 * x1 * x2
  + 2882134154040599/288230376151711744 * x2^2
  + 8419113189306345/288230376151711744 * x0 * x3
  + 732707815199711/309485009821345068724781056 * x1 * x3
  + 4776238841938293/618970019642690137449562112 * x2 * x3
  + 6076437616389409/1152921504606846976 * x3^2
  + -2319135779953501/144115188075855872 * x0 * x4
  + -108719924829229/36028797018963968 * x1 * x4
  + -8401917494282197/2305843009213693952 * x2 * x4
  + -6877733945113811/1152921504606846976 * x3 * x4
  + 583477479438667/288230376151711744 * x4^2
  + -3652219348522333/144115188075855872 * x0 * x5
  + -8112468911137409/1152921504606846976 * x1 * x5
  + -4897929008236683/576460752303423488 * x2 * x5
  + -1371549907490149/144115188075855872 * x3 * x5
  + 7998859121040159/1152921504606846976 * x4 * x5
  + 7041664281999313/1152921504606846976 * x5^2.

Let sigma6 (x0 x1 x2 x3 x4 x5 : R) :=
  7604098453055969/2361183241434822606848
  + -565990850513893/1237940039285380274899124224 * x0
  + -159183917875011/618970019642690137449562112 * x1
  + 309684048246221/1237940039285380274899124224 * x2
  + -117920424648039/309485009821345068724781056 * x3
  + -502743379108343/1237940039285380274899124224 * x4
  + 1535560101713019/1237940039285380274899124224 * x5
  + 1351188380300135/576460752303423488 * x0^2
  + -408016588896549/77371252455336267181195264 * x0 * x1
  + 7604099629505569/2361183241434822606848 * x1^2
  + -5952598513280119/309485009821345068724781056 * x0 * x2
  + 3182721446861451/309485009821345068724781056 * x1 * x2
  + 7604150504443073/2361183241434822606848 * x2^2
  + 1065859029335809/1237940039285380274899124224 * x0 * x3
  + -876291319769381/1237940039285380274899124224 * x1 * x3
  + -625808175928047/618970019642690137449562112 * x2 * x3
  + 7604093658987129/2361183241434822606848 * x3^2
  + -338464061293541/18014398509481984 * x0 * x4
  + 406558911511101/618970019642690137449562112 * x1 * x4
  + 7668596710270251/2475880078570760549798248448 * x2 * x4
  + -2914548770756381/309485009821345068724781056 * x3 * x4
  + 1380659021288277/36028797018963968 * x4^2
  + -8579828406310375/9223372036854775808 * x0 * x5
  + -735619131210583/618970019642690137449562112 * x1 * x5
  + -2780286195271159/618970019642690137449562112 * x2 * x5
  + -378306061232683/618970019642690137449562112 * x3 * x5
  + 8989013648871537/4611686018427387904 * x4 * x5
  + 200364562929445/144115188075855872 * x5^2.

Lemma relax_pos (x0 x1 x2 x3 x4 x5 : R) :
  sigma x0 x1 x2 x3 x4 x5 * p x0 x1 x2 x3 x4 x5
  + sigma' x0 x1 x2 x3 x4 x5 * p' x0 x1 x2 x3 x4 x5
  - sigma1 x0 x1 x2 x3 x4 x5 * b1 x0 x1 x2 x3 x4 x5
  - sigma2 x0 x1 x2 x3 x4 x5 * b2 x0 x1 x2 x3 x4 x5
  - sigma3 x0 x1 x2 x3 x4 x5 * b3 x0 x1 x2 x3 x4 x5
  - sigma4 x0 x1 x2 x3 x4 x5 * b4 x0 x1 x2 x3 x4 x5
  - sigma5 x0 x1 x2 x3 x4 x5 * b5 x0 x1 x2 x3 x4 x5
  - sigma6 x0 x1 x2 x3 x4 x5 * b6 x0 x1 x2 x3 x4 x5 > 0.
Proof.
rewrite /sigma /p /sigma' /p' /sigma1 /b1 /sigma2 /b2 /sigma3 /b3 /sigma4 /b4 /sigma5 /b5 /sigma6 /b6.
validsdp.
Qed.

Lemma sigma_pos (x0 x1 x2 x3 x4 x5 : R) : sigma x0 x1 x2 x3 x4 x5 > 0.
Proof. rewrite /sigma. interval. Qed.

Lemma sigma'_pos (x0 x1 x2 x3 x4 x5 : R) : sigma' x0 x1 x2 x3 x4 x5 >= 0.
Proof. rewrite /sigma'. interval. Qed.

Lemma sigma1_pos (x0 x1 x2 x3 x4 x5 : R) : sigma1 x0 x1 x2 x3 x4 x5 >= 0.
Proof. rewrite /sigma1. validsdp. Qed.

Lemma sigma2_pos (x0 x1 x2 x3 x4 x5 : R) : sigma2 x0 x1 x2 x3 x4 x5 >= 0.
Proof. rewrite /sigma2. validsdp. Qed.

Lemma sigma3_pos (x0 x1 x2 x3 x4 x5 : R) : sigma3 x0 x1 x2 x3 x4 x5 >= 0.
Proof. rewrite /sigma3. validsdp. Qed.

Lemma sigma4_pos (x0 x1 x2 x3 x4 x5 : R) : sigma4 x0 x1 x2 x3 x4 x5 >= 0.
Proof. rewrite /sigma4. validsdp. Qed.

Lemma sigma5_pos (x0 x1 x2 x3 x4 x5 : R) : sigma5 x0 x1 x2 x3 x4 x5 >= 0.
Proof. rewrite /sigma5. validsdp. Qed.

Lemma sigma6_pos (x0 x1 x2 x3 x4 x5 : R) : sigma6 x0 x1 x2 x3 x4 x5 >= 0.
Proof. rewrite /sigma6. validsdp. Qed.

Lemma var_bounds (x l u : R) : l <= x <= u -> (x - l) * (u - x) >= 0.
Proof.
move=> [Hl Hu].
apply Rle_ge.
by apply Interval_missing.Rmult_le_pos_pos; apply Fcore_Raux.Rle_0_minus.
Qed.

Lemma relax (x y z : R) : x >= 0 -> y >= 0 -> z - x * y > 0 -> z > 0.
Proof.
move=> HX Hy.
apply Rge_gt_trans, Rle_ge.
rewrite -{2}(Rminus_0_r z).
apply Rplus_le_compat_l, Ropp_le_contravar.
by apply Interval_missing.Rmult_le_pos_pos; apply Rge_le.
Qed.
  
Lemma relax' (x y z : R) : x >= 0 -> y <= 0 -> z + x * y > 0 -> z > 0.
Proof.
move=> HX Hy.
apply Rge_gt_trans, Rle_ge.
rewrite -{2}(Rplus_0_r z) Rmult_comm.
by apply Rplus_le_compat_l, Interval_missing.Rmult_le_neg_pos; [|apply Rge_le].
Qed.
  
Theorem p_pos (x0 x1 x2 x3 x4 x5 x6 : R) :
  4 <= x0 <= 63504 / 10000 ->
  4 <= x1 <= 63504 / 10000 ->
  4 <= x2 <= 63504 / 10000 ->
  4 <= x3 <= 63504 / 10000 ->
  90601 / 10000 <= x4 <= 254016 / 10000 ->
  4 <= x5 <= 90601 / 10000 ->
  (p x0 x1 x2 x3 x4 x5 > 0 \/ p' x0 x1 x2 x3 x4 x5 > 0).
Proof.
move=> H1 H2 H3 H4 H5 H6.
have Hb0 : b1 x0 x1 x2 x3 x4 x5 >= 0.
{ by apply var_bounds. }
have Hb1 : b2 x0 x1 x2 x3 x4 x5 >= 0.
{ by apply var_bounds. }
have Hb2 : b3 x0 x1 x2 x3 x4 x5 >= 0.
{ by apply var_bounds. }
have Hb3 : b4 x0 x1 x2 x3 x4 x5 >= 0.
{ by apply var_bounds. }
have Hb4 : b5 x0 x1 x2 x3 x4 x5 >= 0.
{ by apply var_bounds. }
have Hb5 : b6 x0 x1 x2 x3 x4 x5 >= 0.
{ by apply var_bounds. }
elim (Rlt_or_le R0 (p' x0 x1 x2 x3 x4 x5))=> Hp'; [by right|].
left.
apply (Rmult_lt_reg_l (sigma x0 x1 x2 x3 x4 x5)); [by apply sigma_pos|].
rewrite Rmult_0_r.
apply (relax' _ _ _ (sigma'_pos x0 x1 x2 x3 x4 x5) Hp').
apply (relax _ _ _ (sigma1_pos x0 x1 x2 x3 x4 x5) Hb0).
apply (relax _ _ _ (sigma2_pos x0 x1 x2 x3 x4 x5) Hb1).
apply (relax _ _ _ (sigma3_pos x0 x1 x2 x3 x4 x5) Hb2).
apply (relax _ _ _ (sigma4_pos x0 x1 x2 x3 x4 x5) Hb3).
apply (relax _ _ _ (sigma5_pos x0 x1 x2 x3 x4 x5) Hb4).
apply (relax _ _ _ (sigma6_pos x0 x1 x2 x3 x4 x5) Hb5).
apply relax_pos.
Qed.
