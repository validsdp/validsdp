From mathcomp Require Import ssreflect.
Require Import Reals.
From Interval Require Import Interval_tactic.
From ValidSDP Require Import validsdp.

Local Open Scope R_scope.

Let p (x0 x1 x2 x3 x4 x5 : R) :=
  - 4/1
  * (x3 * x3 * x0
     + 8/1 * (x4 - x5) * (x1 - x2)
       - x3 * (16/1 * x0 + (x4 - 8/1) * x1 + (x5 - 8/1) * x2)).

Let b1 (x0 x1 x2 x3 x4 x5 : R) :=
  (x0 - 1) * (117547965573/100000000000 - x0).

Let b2 (x0 x1 x2 x3 x4 x5 : R) :=
  (x1 - 1) * (117547965573/100000000000 - x1).

Let b3 (x0 x1 x2 x3 x4 x5 : R) :=
  (x2 - 1) * (117547965573/100000000000 - x2).

Let b4 (x0 x1 x2 x3 x4 x5 : R) :=
  (x3 - 251952632905/100000000000) * (90601/10000 - x3).

Let b5 (x0 x1 x2 x3 x4 x5 : R) :=
  (x4 - 4/1) * (63504/10000 - x4).

Let b6 (x0 x1 x2 x3 x4 x5 : R) :=
  (x5 - 625/100) * (1553/100 - x5).

Let sigma (x0 x1 x2 x3 x4 x5 : R) :=
  4136848951875789/274877906944.

Let sigma1 (x0 x1 x2 x3 x4 x5 : R) :=
  5573225835387301/274877906944 + 568632726455371/274877906944 * x0
  + 43936621760847/68719476736 * x1 + 11036721326989/17179869184 * x2
  + 1100237233775263/274877906944 * x3 + 533474859434671/274877906944 * 
  x4 + 798599616307137/274877906944 * x5
  + 4898928185858445/137438953472 * x0^2
  + 10088197902751/34359738368 * x0 * x1
  + 1730293445483177/68719476736 * x1^2
  + 44373157947149/137438953472 * x0 * x2
  + 83373537652581/137438953472 * x1 * x2 + 216524481580225/8589934592 * 
  x2^2 + 188702043192677/68719476736 * x0 * x3
  + 137393235824509/34359738368 * x1 * x3
  + 2363140804851019/549755813888 * x2 * x3
  + 1308042060944805/17179869184 * x3^2
  + 128726580083237/137438953472 * x0 * x4
  + 548036019226473/274877906944 * x1 * x4
  + 274120839668435/137438953472 * x2 * x4
  + 7999390163193407/549755813888 * x3 * x4
  + 289088103052427/8589934592 * x4^2
  + 469758372034379/274877906944 * x0 * x5
  + 414529915631719/137438953472 * x1 * x5
  + 447058470379097/137438953472 * x2 * x5
  + 937567357526289/34359738368 * x3 * x5
  + 1457087844619271/137438953472 * x4 * x5
  + 3420497090138703/68719476736 * x5^2.

Let sigma2 (x0 x1 x2 x3 x4 x5 : R) :=
  2748253754271467/137438953472 + 2558273666275/8589934592 * x0
  + 505649623215091/274877906944 * x1 + 80929623775683/274877906944 * 
  x2 + 217618947830761/274877906944 * x3 + 220265160891319/274877906944 * 
  x4 + 463161698394559/274877906944 * x5 + 853218532042247/34359738368 * 
  x0^2 + -3186794690903/137438953472 * x0 * x1
  + 2460240634248247/68719476736 * x1^2
  + 16043015102077/68719476736 * x0 * x2
  + -8584939910627/274877906944 * x1 * x2
  + 6835504264872163/274877906944 * x2^2
  + 97333777788813/137438953472 * x0 * x3
  + 4613646040651/137438953472 * x1 * x3
  + 132248521812557/137438953472 * x2 * x3
  + 8648048672300773/274877906944 * x3^2
  + 48596973939415/68719476736 * x0 * x4
  + -5677300894495/274877906944 * x1 * x4
  + 213351656687121/274877906944 * x2 * x4
  + 388407335075457/137438953472 * x3 * x4
  + 7868260534842239/274877906944 * x4^2
  + 370887122295915/274877906944 * x0 * x5
  + 200792410128063/274877906944 * x1 * x5
  + 14093646121109/8589934592 * x2 * x5
  + 2330104150361791/549755813888 * x3 * x5
  + 648124488612185/137438953472 * x4 * x5
  + 1453561509570739/34359738368 * x5^2.

Let sigma3 (x0 x1 x2 x3 x4 x5 : R) :=
  5516083846964391/274877906944 + 11538842740109/34359738368 * x0
  + 108253244800725/274877906944 * x1 + 132047535235331/68719476736 * 
  x2 + 246303431984935/137438953472 * x3 + 180813393739729/137438953472 * 
  x4 + 480099399841141/274877906944 * x5 + 853025712269931/34359738368 * 
  x0^2 + 83537496892201/274877906944 * x0 * x1
  + 6867889245028377/274877906944 * x1^2
  + 25947717736525/274877906944 * x0 * x2
  + 14352143366401/137438953472 * x1 * x2
  + 1225915748639285/34359738368 * x2^2
  + 446819358844993/274877906944 * x0 * x3
  + 291088126822439/137438953472 * x1 * x3
  + 217798191840927/137438953472 * x2 * x3
  + 6177238638748587/137438953472 * x3^2
  + 292766055205115/274877906944 * x0 * x4
  + 183643779078687/137438953472 * x1 * x4
  + 17834053855547/34359738368 * x2 * x4
  + 61987247775599/8589934592 * x3 * x4
  + 8513268251782031/274877906944 * x4^2
  + 447279484794071/274877906944 * x0 * x5
  + 269993807654467/137438953472 * x1 * x5
  + 372895008003693/274877906944 * x2 * x5
  + 6641145499569543/549755813888 * x3 * x5
  + 967999045519507/137438953472 * x4 * x5
  + 6122451635569255/137438953472 * x5^2.

Let sigma4 (x0 x1 x2 x3 x4 x5 : R) :=
  1845325416934553/137438953472 + 160036308018069/137438953472 * x0
  + -429794431926639/274877906944 * x1 + -194056081052379/137438953472 * 
  x2 + -227909617740681/137438953472 * x3 + -17540504031457/8589934592 * 
  x4 + -167386349475275/274877906944 * x5
  + 4336877898468081/274877906944 * x0^2
  + -51849146436117/137438953472 * x0 * x1
  + 3803704984481191/274877906944 * x1^2
  + 62629419707297/274877906944 * x0 * x2
  + -95048817510001/68719476736 * x1 * x2
  + 1892649114917541/137438953472 * x2^2
  + -1159640005756305/274877906944 * x0 * x3
  + -782848124049559/274877906944 * x1 * x3
  + -844603692681355/274877906944 * x2 * x3
  + 1047269369121225/274877906944 * x3^2
  + 94523867107221/274877906944 * x0 * x4
  + -318373454695971/274877906944 * x1 * x4
  + -100470546855063/68719476736 * x2 * x4
  + -39498358235759/8589934592 * x3 * x4
  + 4179369827001033/549755813888 * x4^2
  + -143492561551495/274877906944 * x0 * x5
  + -184676297470965/274877906944 * x1 * x5
  + -76159012421441/137438953472 * x2 * x5
  + -392930979721091/274877906944 * x3 * x5
  + -1066014175203967/274877906944 * x4 * x5
  + 570413654068271/274877906944 * x5^2.

Let sigma5 (x0 x1 x2 x3 x4 x5 : R) :=
  1840409201889959/137438953472 + -158308531981927/274877906944 * x0
  + -8298937801429/68719476736 * x1 + 173383347857663/274877906944 * 
  x2 + -59247683911677/34359738368 * x3 + 580479963732741/274877906944 * 
  x4 + -99432612867625/68719476736 * x5 + 499468738260185/34359738368 * 
  x0^2 + -10471364433229/17179869184 * x0 * x1
  + 1992446538947623/137438953472 * x1^2
  + -51225267435199/137438953472 * x0 * x2
  + 30584425181477/68719476736 * x1 * x2
  + 2132126316560085/137438953472 * x2^2
  + -37068776317763/17179869184 * x0 * x3
  + 5183180602017/68719476736 * x1 * x3
  + 2000845311739/274877906944 * x2 * x3
  + 3126886077238487/549755813888 * x3^2
  + -188481143691841/137438953472 * x0 * x4
  + -193391581529661/137438953472 * x1 * x4
  + -342955471525341/137438953472 * x2 * x4
  + -121152705475055/17179869184 * x3 * x4
  + 4027683000980249/274877906944 * x4^2
  + -193431015891879/274877906944 * x0 * x5
  + -410373600211343/274877906944 * x1 * x5
  + 9580139109351/34359738368 * x2 * x5
  + -516436849249741/274877906944 * x3 * x5
  + -1254656076320545/137438953472 * x4 * x5
  + 2760692521422831/549755813888 * x5^2.

Let sigma6 (x0 x1 x2 x3 x4 x5 : R) :=
  1641379811105579/274877906944 + -13251315804379/17179869184 * x0
  + 10754683220609/17179869184 * x1 + -10158653002011/68719476736 * x2
  + -67134017731227/274877906944 * x3 + -165726142522997/137438953472 * 
  x4 + -79794276674107/274877906944 * x5
  + 882152463928235/137438953472 * x0^2
  + -141295479674735/274877906944 * x0 * x1
  + 239451857715735/34359738368 * x1^2
  + -51480629310273/68719476736 * x0 * x2
  + 72132909366637/137438953472 * x1 * x2
  + 1798841596142749/274877906944 * x2^2
  + -190688389061201/274877906944 * x0 * x3
  + 11689907746071/68719476736 * x1 * x3
  + 141099673533099/274877906944 * x2 * x3 + 11158592959873/8589934592 * 
  x3^2 + -39683169892413/137438953472 * x0 * x4
  + 170978973039225/274877906944 * x1 * x4
  + -296151018119747/274877906944 * x2 * x4
  + -194145886405311/274877906944 * x3 * x4
  + 2232715698939247/549755813888 * x4^2
  + -44300543363257/68719476736 * x0 * x5
  + -204241098641701/137438953472 * x1 * x5
  + -130905690461191/137438953472 * x2 * x5
  + -170402883394865/274877906944 * x3 * x5
  + -208010415878237/68719476736 * x4 * x5
  + 147378852678933/137438953472 * x5^2.

Lemma relax_pos (x0 x1 x2 x3 x4 x5 : R) :
  sigma x0 x1 x2 x3 x4 x5 * p x0 x1 x2 x3 x4 x5
  - sigma1 x0 x1 x2 x3 x4 x5 * b1 x0 x1 x2 x3 x4 x5
  - sigma2 x0 x1 x2 x3 x4 x5 * b2 x0 x1 x2 x3 x4 x5
  - sigma3 x0 x1 x2 x3 x4 x5 * b3 x0 x1 x2 x3 x4 x5
  - sigma4 x0 x1 x2 x3 x4 x5 * b4 x0 x1 x2 x3 x4 x5
  - sigma5 x0 x1 x2 x3 x4 x5 * b5 x0 x1 x2 x3 x4 x5
  - sigma6 x0 x1 x2 x3 x4 x5 * b6 x0 x1 x2 x3 x4 x5 > 0.
Proof.
rewrite /sigma /p /sigma1 /b1 /sigma2 /b2 /sigma3 /b3 /sigma4 /b4 /sigma5 /b5 /sigma6 /b6.
validsdp.
Qed.

Lemma sigma_pos (x0 x1 x2 x3 x4 x5 : R) : sigma x0 x1 x2 x3 x4 x5 > 0.
Proof. rewrite /sigma. interval. Qed.

Lemma sigma1_pos (x0 x1 x2 x3 x4 x5 : R) : sigma1 x0 x1 x2 x3 x4 x5 >= 0.
Proof. rewrite /sigma1. validsdp. Qed.

Lemma sigma2_pos (x0 x1 x2 x3 x4 x5 : R) : sigma2 x0 x1 x2 x3 x4 x5 >= 0.
Proof. rewrite /sigma2. validsdp. Qed.

Lemma sigma3_pos (x0 x1 x2 x3 x4 x5 : R) : sigma3 x0 x1 x2 x3 x4 x5 >= 0.
Proof. rewrite /sigma3. validsdp. Qed.

Lemma sigma4_pos (x0 x1 x2 x3 x4 x5 : R) : sigma4 x0 x1 x2 x3 x4 x5 >= 0.
Proof. rewrite /sigma4. validsdp. Qed.

Lemma sigma5_pos (x0 x1 x2 x3 x4 x5 : R) : sigma5 x0 x1 x2 x3 x4 x5 >= 0.
Proof. rewrite /sigma5. validsdp. Qed.

Lemma sigma6_pos (x0 x1 x2 x3 x4 x5 : R) : sigma6 x0 x1 x2 x3 x4 x5 >= 0.
Proof. rewrite /sigma6. validsdp. Qed.

Lemma var_bounds (x l u : R) : l <= x <= u -> (x - l) * (u - x) >= 0.
Proof.
move=> [Hl Hu].
apply Rle_ge.
by apply Interval_missing.Rmult_le_pos_pos; apply Fcore_Raux.Rle_0_minus.
Qed.

Lemma relax (x y z : R) : x >= 0 -> y >= 0 -> z - x * y > 0 -> z > 0.
Proof.
move=> HX Hy.
apply Rge_gt_trans, Rle_ge.
rewrite -{2}(Rminus_0_r z).
apply Rplus_le_compat_l, Ropp_le_contravar.
by apply Interval_missing.Rmult_le_pos_pos; apply Rge_le.
Qed.
  
Theorem p_pos (x0 x1 x2 x3 x4 x5 x6 : R) :
  1 <= x0 <= 117547965573 / 100000000000 ->
  1 <= x1 <= 117547965573 / 100000000000 ->
  1 <= x2 <= 117547965573 / 100000000000 ->
  251952632905 / 100000000000 <= x3 <= 90601 / 10000 ->
  4 <= x4 <= 63504 / 10000 ->
  625 / 100 <= x5 <= 1553 / 100 ->
  p x0 x1 x2 x3 x4 x5 > 0.
Proof.
move=> H1 H2 H3 H4 H5 H6.
have Hb0 : b1 x0 x1 x2 x3 x4 x5 >= 0.
{ by apply var_bounds. }
have Hb1 : b2 x0 x1 x2 x3 x4 x5 >= 0.
{ by apply var_bounds. }
have Hb2 : b3 x0 x1 x2 x3 x4 x5 >= 0.
{ by apply var_bounds. }
have Hb3 : b4 x0 x1 x2 x3 x4 x5 >= 0.
{ by apply var_bounds. }
have Hb4 : b5 x0 x1 x2 x3 x4 x5 >= 0.
{ by apply var_bounds; rewrite !Rcomplements.Rdiv_1. }
have Hb5 : b6 x0 x1 x2 x3 x4 x5 >= 0.
{ by apply var_bounds. }
apply (Rmult_lt_reg_l (sigma x0 x1 x2 x3 x4 x5)); [by apply sigma_pos|].
rewrite Rmult_0_r.
apply (relax _ _ _ (sigma1_pos x0 x1 x2 x3 x4 x5) Hb0).
apply (relax _ _ _ (sigma2_pos x0 x1 x2 x3 x4 x5) Hb1).
apply (relax _ _ _ (sigma3_pos x0 x1 x2 x3 x4 x5) Hb2).
apply (relax _ _ _ (sigma4_pos x0 x1 x2 x3 x4 x5) Hb3).
apply (relax _ _ _ (sigma5_pos x0 x1 x2 x3 x4 x5) Hb4).
apply (relax _ _ _ (sigma6_pos x0 x1 x2 x3 x4 x5) Hb5).
apply relax_pos.
Qed.
