From mathcomp Require Import ssreflect.
Require Import Reals.
From Interval Require Import Interval_tactic.
From ValidSDP Require Import validsdp.

Local Open Scope R_scope.

Let p (x0 x1 x2 x3 x4 x5 : R) :=
  x0 * x3 * (0 - x0 + x1 + x2 - x3 + x4 + x5)
  + x1 * x4 * (x0 - x1 + x2 + x3 - x4 + x5)
  + x2 * x5 * (x0 + x1 - x2 + x3 + x4 - x5) - x1 * x2 * x3 - x0 * x2 * x4
  - x0 * x1 * x5 - x3 * x4 * x5.

Let b1 (x0 x1 x2 x3 x4 x5 : R) :=
  (x0 - 4/1) * (63504/10000 - x0).

Let b2 (x0 x1 x2 x3 x4 x5 : R) :=
  (x1 - 4/1) * (63504/10000 - x1).

Let b3 (x0 x1 x2 x3 x4 x5 : R) :=
  (x2 - 4/1) * (63504/10000 - x2).

Let b4 (x0 x1 x2 x3 x4 x5 : R) :=
  (x3 - 4/1) * (63504/10000 - x3).

Let b5 (x0 x1 x2 x3 x4 x5 : R) :=
  (x4 - 4/1) * (63504/10000 - x4).

Let b6 (x0 x1 x2 x3 x4 x5 : R) :=
  (x5 - 4/1) * (63504/10000 - x5).

Let sigma (x0 x1 x2 x3 x4 x5 : R) :=
  4881591411622179/1125899906842624.

Let sigma1 (x0 x1 x2 x3 x4 x5 : R) :=
  6400829366907503/9007199254740992 + 8363501619592581/18014398509481984 * 
  x0 + -5086216689759189/72057594037927936 * x1
  + -5086216689758989/72057594037927936 * x2
  + -5017069921851987/72057594037927936 * x3
  + -2543108344879543/36028797018963968 * x4
  + -5086216689758805/72057594037927936 * x5
  + 4904266143045505/4503599627370496 * x0^2
  + -4216658101905293/18014398509481984 * x0 * x1
  + 7016621357201491/9007199254740992 * x1^2
  + -1054164525476279/4503599627370496 * x0 * x2
  + -2338703402207867/72057594037927936 * x1 * x2
  + 1754155339300349/2251799813685248 * x2^2
  + -1278362653967445/4503599627370496 * x0 * x3
  + 1724351704092555/36028797018963968 * x1 * x3
  + 1724351704092163/36028797018963968 * x2 * x3
  + 6783951699299859/9007199254740992 * x3^2
  + -4216658101905015/18014398509481984 * x0 * x4
  + 8909787072168213/144115188075855872 * x1 * x4
  + -6550204575453113/72057594037927936 * x2 * x4
  + 6897406816367793/144115188075855872 * x3 * x4
  + 1754155339300317/2251799813685248 * x4^2
  + -8433316203810007/36028797018963968 * x0 * x5
  + -6550204575452139/72057594037927936 * x1 * x5
  + 8909787072168085/144115188075855872 * x2 * x5
  + 1724351704092619/36028797018963968 * x3 * x5
  + -2338703402208121/72057594037927936 * x4 * x5
  + 438538834825097/562949953421312 * x5^2.

Let sigma2 (x0 x1 x2 x3 x4 x5 : R) :=
  6400829366907511/9007199254740992
  + -5086216689758989/72057594037927936 * x0
  + 1045437702449071/2251799813685248 * x1
  + -2543108344879629/36028797018963968 * x2
  + -79472135777485/1125899906842624 * x3
  + -2508534960926123/36028797018963968 * x4
  + -1271554172439823/18014398509481984 * x5
  + 7016621357201481/9007199254740992 * x0^2
  + -8433316203809903/36028797018963968 * x0 * x1
  + 4904266143045549/4503599627370496 * x1^2
  + -584675850552075/18014398509481984 * x0 * x2
  + -8433316203810769/36028797018963968 * x1 * x2
  + 7016621357201445/9007199254740992 * x2^2
  + 8909787072171097/144115188075855872 * x0 * x3
  + -8433316203810569/36028797018963968 * x1 * x3
  + -1637551143862819/18014398509481984 * x2 * x3
  + 1754155339300381/2251799813685248 * x3^2
  + 6897406816370913/144115188075855872 * x0 * x4
  + -2556725307935061/9007199254740992 * x1 * x4
  + 6897406816367931/144115188075855872 * x2 * x4
  + 3448703408184915/72057594037927936 * x3 * x4
  + 6783951699299741/9007199254740992 * x4^2
  + -3275102287725751/36028797018963968 * x0 * x5
  + -8433316203810599/36028797018963968 * x1 * x5
  + 8909787072166355/144115188075855872 * x2 * x5
  + -4677406804415879/144115188075855872 * x3 * x5
  + 3448703408184243/72057594037927936 * x4 * x5
  + 1754155339300369/2251799813685248 * x5^2.

Let sigma3 (x0 x1 x2 x3 x4 x5 : R) :=
  6400829366907523/9007199254740992
  + -2543108344879297/36028797018963968 * x0
  + -5086216689758923/72057594037927936 * x1
  + 4181750809796305/9007199254740992 * x2
  + -317888543109927/4503599627370496 * x3
  + -5086216689759023/72057594037927936 * x4
  + -2508534960926019/36028797018963968 * x5
  + 7016621357201417/9007199254740992 * x0^2
  + -2338703402207283/72057594037927936 * x0 * x1
  + 3508310678600731/4503599627370496 * x1^2
  + -8433316203810227/36028797018963968 * x0 * x2
  + -8433316203810011/36028797018963968 * x1 * x2
  + 4904266143045511/4503599627370496 * x2^2
  + 8909787072170965/144115188075855872 * x0 * x3
  + -6550204575451371/72057594037927936 * x1 * x3
  + -8433316203810215/36028797018963968 * x2 * x3
  + 3508310678600815/4503599627370496 * x3^2
  + -3275102287725921/36028797018963968 * x0 * x4
  + 4454893536084345/72057594037927936 * x1 * x4
  + -8433316203810701/36028797018963968 * x2 * x4
  + -4677406804416003/144115188075855872 * x3 * x4
  + 3508310678600701/4503599627370496 * x4^2
  + 6897406816371001/144115188075855872 * x0 * x5
  + 6897406816369505/144115188075855872 * x1 * x5
  + -1278362653967477/4503599627370496 * x2 * x5
  + 6897406816371971/144115188075855872 * x3 * x5
  + 6897406816369237/144115188075855872 * x4 * x5
  + 3391975849649991/4503599627370496 * x5^2.

Let sigma4 (x0 x1 x2 x3 x4 x5 : R) :=
  1600207341726893/2251799813685248
  + -2508534960925777/36028797018963968 * x0
  + -5086216689758447/72057594037927936 * x1
  + -5086216689758383/72057594037927936 * x2
  + 8363501619592813/18014398509481984 * x3
  + -635777086219813/9007199254740992 * x4
  + -5086216689758529/72057594037927936 * x5
  + 6783951699300131/9007199254740992 * x0^2
  + 3448703408187545/72057594037927936 * x0 * x1
  + 1754155339300371/2251799813685248 * x1^2
  + 6897406816373229/144115188075855872 * x0 * x2
  + -6550204575450753/72057594037927936 * x1 * x2
  + 3508310678600731/4503599627370496 * x2^2
  + -5113450615869411/18014398509481984 * x0 * x3
  + -1054164525476279/4503599627370496 * x1 * x3
  + -4216658101904621/18014398509481984 * x2 * x3
  + 2452133071522781/2251799813685248 * x3^2
  + 3448703408185481/72057594037927936 * x0 * x4
  + 8909787072171597/144115188075855872 * x1 * x4
  + -2338703402207717/72057594037927936 * x2 * x4
  + -4216658101904823/18014398509481984 * x3 * x4
  + 1754155339300339/2251799813685248 * x4^2
  + 6897406816370911/144115188075855872 * x0 * x5
  + -292337925275845/9007199254740992 * x1 * x5
  + 2227446768042833/36028797018963968 * x2 * x5
  + -8433316203810215/36028797018963968 * x3 * x5
  + -6550204575451381/72057594037927936 * x4 * x5
  + 877077669650185/1125899906842624 * x5^2.

Let sigma5 (x0 x1 x2 x3 x4 x5 : R) :=
  6400829366907533/9007199254740992
  + -5086216689759303/72057594037927936 * x0
  + -313566870115781/4503599627370496 * x1
  + -5086216689759469/72057594037927936 * x2
  + -5086216689759301/72057594037927936 * x3
  + 8363501619592525/18014398509481984 * x4
  + -2543108344879593/36028797018963968 * x5
  + 7016621357201453/9007199254740992 * x0^2
  + 6897406816370711/144115188075855872 * x0 * x1
  + 6783951699299955/9007199254740992 * x1^2
  + -6550204575452831/72057594037927936 * x0 * x2
  + 6897406816369075/144115188075855872 * x1 * x2
  + 7016621357201291/9007199254740992 * x2^2
  + 4454893536085161/72057594037927936 * x0 * x3
  + 3448703408185815/72057594037927936 * x1 * x3
  + -1169351701104529/36028797018963968 * x2 * x3
  + 877077669650189/1125899906842624 * x3^2
  + -4216658101905403/18014398509481984 * x0 * x4
  + -639181326983765/2251799813685248 * x1 * x4
  + -8433316203810607/36028797018963968 * x2 * x4
  + -8433316203811115/36028797018963968 * x3 * x4
  + 4904266143045505/4503599627370496 * x4^2
  + -1169351701103989/36028797018963968 * x0 * x5
  + 3367874422055/70368744177664 * x1 * x5
  + 8909787072167405/144115188075855872 * x2 * x5
  + -3275102287725969/36028797018963968 * x3 * x5
  + -4216658101905505/18014398509481984 * x4 * x5
  + 7016621357201397/9007199254740992 * x5^2.

Let sigma6 (x0 x1 x2 x3 x4 x5 : R) :=
  3200414683453769/4503599627370496
  + -5086216689758741/72057594037927936 * x0
  + -1271554172439657/18014398509481984 * x1
  + -5017069921851493/72057594037927936 * x2
  + -5086216689758559/72057594037927936 * x3
  + -1271554172439687/18014398509481984 * x4
  + 2090875404898169/4503599627370496 * x5
  + 7016621357201371/9007199254740992 * x0^2
  + -6550204575451237/72057594037927936 * x0 * x1
  + 877077669650179/1125899906842624 * x1^2
  + 1724351704092925/36028797018963968 * x0 * x2
  + 3448703408184639/72057594037927936 * x1 * x2
  + 1695987924825061/2251799813685248 * x2^2
  + 2227446768042909/36028797018963968 * x0 * x3
  + -2338703402206959/72057594037927936 * x1 * x3
  + 6897406816372483/144115188075855872 * x2 * x3
  + 1754155339300393/2251799813685248 * x3^2
  + -1169351701103825/36028797018963968 * x0 * x4
  + 8909787072167287/144115188075855872 * x1 * x4
  + 3448703408185673/72057594037927936 * x2 * x4
  + -6550204575450771/72057594037927936 * x3 * x4
  + 7016621357201361/9007199254740992 * x4^2
  + -8433316203809971/36028797018963968 * x0 * x5
  + -4216658101904817/18014398509481984 * x1 * x5
  + -5113450615869373/18014398509481984 * x2 * x5
  + -4216658101905263/18014398509481984 * x3 * x5
  + -131770565684535/562949953421312 * x4 * x5
  + 4904266143045639/4503599627370496 * x5^2.

Lemma relax_pos (x0 x1 x2 x3 x4 x5 : R) :
  sigma x0 x1 x2 x3 x4 x5 * p x0 x1 x2 x3 x4 x5
  - sigma1 x0 x1 x2 x3 x4 x5 * b1 x0 x1 x2 x3 x4 x5
  - sigma2 x0 x1 x2 x3 x4 x5 * b2 x0 x1 x2 x3 x4 x5
  - sigma3 x0 x1 x2 x3 x4 x5 * b3 x0 x1 x2 x3 x4 x5
  - sigma4 x0 x1 x2 x3 x4 x5 * b4 x0 x1 x2 x3 x4 x5
  - sigma5 x0 x1 x2 x3 x4 x5 * b5 x0 x1 x2 x3 x4 x5
  - sigma6 x0 x1 x2 x3 x4 x5 * b6 x0 x1 x2 x3 x4 x5 > 0.
Proof.
rewrite /sigma /p /sigma1 /b1 /sigma2 /b2 /sigma3 /b3 /sigma4 /b4 /sigma5 /b5 /sigma6 /b6.
validsdp.
Qed.

Lemma sigma_pos (x0 x1 x2 x3 x4 x5 : R) : sigma x0 x1 x2 x3 x4 x5 > 0.
Proof. rewrite /sigma. interval. Qed.

Lemma sigma1_pos (x0 x1 x2 x3 x4 x5 : R) : sigma1 x0 x1 x2 x3 x4 x5 >= 0.
Proof. rewrite /sigma1. validsdp. Qed.

Lemma sigma2_pos (x0 x1 x2 x3 x4 x5 : R) : sigma2 x0 x1 x2 x3 x4 x5 >= 0.
Proof. rewrite /sigma2. validsdp. Qed.

Lemma sigma3_pos (x0 x1 x2 x3 x4 x5 : R) : sigma3 x0 x1 x2 x3 x4 x5 >= 0.
Proof. rewrite /sigma3. validsdp. Qed.

Lemma sigma4_pos (x0 x1 x2 x3 x4 x5 : R) : sigma4 x0 x1 x2 x3 x4 x5 >= 0.
Proof. rewrite /sigma4. validsdp. Qed.

Lemma sigma5_pos (x0 x1 x2 x3 x4 x5 : R) : sigma5 x0 x1 x2 x3 x4 x5 >= 0.
Proof. rewrite /sigma5. validsdp. Qed.

Lemma sigma6_pos (x0 x1 x2 x3 x4 x5 : R) : sigma6 x0 x1 x2 x3 x4 x5 >= 0.
Proof. rewrite /sigma6. validsdp. Qed.

Lemma var_bounds (x l u : R) : l <= x <= u -> (x - l) * (u - x) >= 0.
Proof.
move=> [Hl Hu].
apply Rle_ge.
by apply Interval_missing.Rmult_le_pos_pos; apply Fcore_Raux.Rle_0_minus.
Qed.

Lemma relax (x y z : R) : x >= 0 -> y >= 0 -> z - x * y > 0 -> z > 0.
Proof.
move=> HX Hy.
apply Rge_gt_trans, Rle_ge.
rewrite -{2}(Rminus_0_r z).
apply Rplus_le_compat_l, Ropp_le_contravar.
by apply Interval_missing.Rmult_le_pos_pos; apply Rge_le.
Qed.
  
Theorem p_pos (x0 x1 x2 x3 x4 x5 x6 : R) :
  4 <= x0 <= 63504 / 10000 ->
  4 <= x1 <= 63504 / 10000 ->
  4 <= x2 <= 63504 / 10000 ->
  4 <= x3 <= 63504 / 10000 ->
  4 <= x4 <= 63504 / 10000 ->
  4 <= x5 <= 63504 / 10000 ->
  p x0 x1 x2 x3 x4 x5 > 0.
Proof.
move=> H1 H2 H3 H4 H5 H6.
have Hb0 : b1 x0 x1 x2 x3 x4 x5 >= 0.
{ by apply var_bounds; rewrite !Rcomplements.Rdiv_1. }
have Hb1 : b2 x0 x1 x2 x3 x4 x5 >= 0.
{ by apply var_bounds; rewrite !Rcomplements.Rdiv_1. }
have Hb2 : b3 x0 x1 x2 x3 x4 x5 >= 0.
{ by apply var_bounds; rewrite !Rcomplements.Rdiv_1. }
have Hb3 : b4 x0 x1 x2 x3 x4 x5 >= 0.
{ by apply var_bounds; rewrite !Rcomplements.Rdiv_1. }
have Hb4 : b5 x0 x1 x2 x3 x4 x5 >= 0.
{ by apply var_bounds; rewrite !Rcomplements.Rdiv_1. }
have Hb5 : b6 x0 x1 x2 x3 x4 x5 >= 0.
{ by apply var_bounds; rewrite !Rcomplements.Rdiv_1. }
apply (Rmult_lt_reg_l (sigma x0 x1 x2 x3 x4 x5)); [by apply sigma_pos|].
rewrite Rmult_0_r.
apply (relax _ _ _ (sigma1_pos x0 x1 x2 x3 x4 x5) Hb0).
apply (relax _ _ _ (sigma2_pos x0 x1 x2 x3 x4 x5) Hb1).
apply (relax _ _ _ (sigma3_pos x0 x1 x2 x3 x4 x5) Hb2).
apply (relax _ _ _ (sigma4_pos x0 x1 x2 x3 x4 x5) Hb3).
apply (relax _ _ _ (sigma5_pos x0 x1 x2 x3 x4 x5) Hb4).
apply (relax _ _ _ (sigma6_pos x0 x1 x2 x3 x4 x5) Hb5).
apply relax_pos.
Qed.
