From mathcomp Require Import ssreflect.
Require Import Reals.
From Interval Require Import Interval_tactic.
From ValidSDP Require Import validsdp.

Local Open Scope R_scope.

Let p (x0 x1 x2 x3 x4 x5 : R) :=
  x0 * x3 * (0 - x0 + x1 + x2 - x3 + x4 + x5)
  + x1 * x4 * (x0 - x1 + x2 + x3 - x4 + x5)
  + x2 * x5 * (x0 + x1 - x2 + x3 + x4 - x5) - x1 * x2 * x3 - x0 * x2 * x4
  - x0 * x1 * x5 - x3 * x4 * x5.

Let b1 (x0 x1 x2 x3 x4 x5 : R) :=
  (x0 - 606887582536 / 100000000000) * (702674064 / 100000000 - x0).

Let b2 (x0 x1 x2 x3 x4 x5 : R) :=
  (x1 - 4/1) * (8/1 - x1).

Let b3 (x0 x1 x2 x3 x4 x5 : R) :=
  (x2 - 4/1) * (8/1 - x2).

Let b4 (x0 x1 x2 x3 x4 x5 : R) :=
  (x3 - 4/1) * (8/1 - x3).

Let b5 (x0 x1 x2 x3 x4 x5 : R) :=
  (x4 - 4/1) * (8/1 - x4).

Let b6 (x0 x1 x2 x3 x4 x5 : R) :=
  (x5 - 4/1) * (8/1 - x5).

Let sigma (x0 x1 x2 x3 x4 x5 : R) :=
  1431909523336109/281474976710656.

Let sigma1 (x0 x1 x2 x3 x4 x5 : R) :=
  5135463731502041/9007199254740992 + 3689258204434167/9007199254740992 * 
  x0 + -3274458800482917/144115188075855872 * x1
  + -204653675030403/9007199254740992 * x2
  + -6629540040290725/288230376151711744 * x3
  + -3274458800478707/144115188075855872 * x4
  + -6548917600973287/288230376151711744 * x5
  + 4102356514757713/4503599627370496 * x0^2
  + -3223908356193201/72057594037927936 * x0 * x1
  + 3120431236019253/4503599627370496 * x1^2
  + -6447816712399901/144115188075855872 * x0 * x2
  + 1303127616506883/9007199254740992 * x1 * x2
  + 780107809004669/1125899906842624 * x2^2
  + -5156460827019891/72057594037927936 * x0 * x3
  + 1996312130628683/9007199254740992 * x1 * x3
  + 3992624261254583/18014398509481984 * x2 * x3
  + 6269066233967503/9007199254740992 * x3^2
  + -3223908356189159/72057594037927936 * x0 * x4
  + 7989736674954351/36028797018963968 * x1 * x4
  + 1683385469248013/18014398509481984 * x2 * x4
  + 7985248522515717/36028797018963968 * x3 * x4
  + 6240862472039521/9007199254740992 * x4^2
  + -3223908356199039/72057594037927936 * x0 * x5
  + 3366770938493685/36028797018963968 * x1 * x5
  + 499358542183917/2251799813685248 * x2 * x5
  + 7985248522508719/36028797018963968 * x3 * x5
  + 1303127616506929/9007199254740992 * x4 * x5
  + 6240862472037545/9007199254740992 * x5^2.

Let sigma2 (x0 x1 x2 x3 x4 x5 : R) :=
  6040572702197323/9007199254740992
  + -1272751593221165/18014398509481984 * x0
  + 7274732626276505/18014398509481984 * x1
  + -3152434857185843/36028797018963968 * x2
  + -5935987291717809/72057594037927936 * x3
  + -2705458739959143/36028797018963968 * x4
  + -3274301299210235/36028797018963968 * x5
  + 6138640022654725/9007199254740992 * x0^2
  + -2885794407724299/9007199254740992 * x0 * x1
  + 2125373303613789/2251799813685248 * x1^2
  + -2253826779845877/18014398509481984 * x0 * x2
  + -5320225347144745/18014398509481984 * x1 * x2
  + 6062336231496725/9007199254740992 * x2^2
  + -658134937218353/36028797018963968 * x0 * x3
  + -80417557313311/281474976710656 * x1 * x3
  + -2886757815597095/18014398509481984 * x2 * x3
  + 6178452145195731/9007199254740992 * x3^2
  + -238848745092191/18014398509481984 * x0 * x4
  + -5532036022373133/18014398509481984 * x1 * x4
  + -2617407522304987/576460752303423488 * x2 * x4
  + 5717852857051119/1152921504606846976 * x3 * x4
  + 24169027971135/35184372088832 * x4^2
  + -6760156559860361/36028797018963968 * x0 * x5
  + -1355616592533425/4503599627370496 * x1 * x5
  + -8909981516128781/576460752303423488 * x2 * x5
  + -3824425223350659/36028797018963968 * x3 * x5
  + -550899165622453/144115188075855872 * x4 * x5
  + 6026035745681743/9007199254740992 * x5^2.

Let sigma3 (x0 x1 x2 x3 x4 x5 : R) :=
  1510143175549329/2251799813685248
  + -5091006372882903/72057594037927936 * x0
  + -1576217428593687/18014398509481984 * x1
  + 7274732626276021/18014398509481984 * x2
  + -5935987291719181/72057594037927936 * x3
  + -6548602598423657/72057594037927936 * x4
  + -5410917479917969/72057594037927936 * x5
  + 6138640022654707/9007199254740992 * x0^2
  + -563456694961323/4503599627370496 * x0 * x1
  + 1515584057874123/2251799813685248 * x1^2
  + -2885794407724789/9007199254740992 * x0 * x2
  + -5320225347146257/18014398509481984 * x1 * x2
  + 2125373303613693/2251799813685248 * x2^2
  + -5265079497747961/288230376151711744 * x0 * x3
  + -5773515631197151/36028797018963968 * x1 * x3
  + -5146723668053599/18014398509481984 * x2 * x3
  + 6178452145195927/9007199254740992 * x3^2
  + -1690039139965939/9007199254740992 * x0 * x4
  + -4454990758098715/288230376151711744 * x1 * x4
  + -2711233185067525/9007199254740992 * x2 * x4
  + -7648850446702001/72057594037927936 * x3 * x4
  + 6026035745681103/9007199254740992 * x4^2
  + -1910789960720061/144115188075855872 * x0 * x5
  + -654351880577143/144115188075855872 * x1 * x5
  + -1383009005593475/4503599627370496 * x2 * x5
  + 2858926428605213/576460752303423488 * x3 * x5
  + -8814386650165679/2305843009213693952 * x4 * x5
  + 3093635580305657/4503599627370496 * x5^2.

Let sigma4 (x0 x1 x2 x3 x4 x5 : R) :=
  6048237059445319/9007199254740992
  + -5314267252080439/72057594037927936 * x0
  + -2781767958695385/36028797018963968 * x1
  + -86930248709221/1125899906842624 * x2
  + 7329704083897201/18014398509481984 * x3
  + -5563535917391523/72057594037927936 * x4
  + -5563535917388817/72057594037927936 * x5
  + 2899147296644009/4503599627370496 * x0^2
  + -1344851258779031/36028797018963968 * x0 * x1
  + 6268856673703161/9007199254740992 * x1^2
  + -5379405035094419/144115188075855872 * x0 * x2
  + -1244653121703809/9007199254740992 * x1 * x2
  + 6268856673703873/9007199254740992 * x2^2
  + -6618136223826841/18014398509481984 * x0 * x3
  + -4914151717687561/18014398509481984 * x1 * x3
  + -2457075858843831/9007199254740992 * x2 * x3
  + 2136435084548917/2251799813685248 * x3^2
  + -2689702517551839/72057594037927936 * x0 * x4
  + 4745456116276105/144115188075855872 * x1 * x4
  + -5862272575966399/72057594037927936 * x2 * x4
  + -1228537929421819/4503599627370496 * x3 * x4
  + 391803542106449/562949953421312 * x4^2
  + -5379405035075849/144115188075855872 * x0 * x5
  + -5862272575974317/72057594037927936 * x1 * x5
  + 148295503634517/4503599627370496 * x2 * x5
  + -2457075858843577/9007199254740992 * x3 * x5
  + -2489306243406265/18014398509481984 * x4 * x5
  + 3134428336852003/4503599627370496 * x5^2.

Let sigma5 (x0 x1 x2 x3 x4 x5 : R) :=
  3020286351098645/4503599627370496
  + -5091006372881157/72057594037927936 * x0
  + -5410917479922235/72057594037927936 * x1
  + -6548602598421277/72057594037927936 * x2
  + -5935987291719275/72057594037927936 * x3
  + 7274732626275861/18014398509481984 * x4
  + -6304869714370399/72057594037927936 * x5
  + 3069320011328225/4503599627370496 * x0^2
  + -3821579921445429/288230376151711744 * x0 * x1
  + 6187271160609861/9007199254740992 * x1^2
  + -6760156559860807/36028797018963968 * x0 * x2
  + -4407193325048719/1152921504606846976 * x1 * x2
  + 6026035745681745/9007199254740992 * x2^2
  + -5265079497710777/288230376151711744 * x0 * x3
  + 44670725445481/9007199254740992 * x1 * x3
  + -956106305837641/9007199254740992 * x2 * x3
  + 3089226072597715/4503599627370496 * x3^2
  + -360724300965565/1125899906842624 * x0 * x4
  + -86438062849653/281474976710656 * x1 * x4
  + -5422466370134691/18014398509481984 * x2 * x4
  + -1286680917013305/4503599627370496 * x3 * x4
  + 4250746607227397/4503599627370496 * x4^2
  + -563456694960433/4503599627370496 * x0 * x5
  + -1308703761119067/288230376151711744 * x1 * x5
  + -8909981516037331/576460752303423488 * x2 * x5
  + -90211181737381/562949953421312 * x3 * x5
  + -5320225347145131/18014398509481984 * x4 * x5
  + 6062336231498121/9007199254740992 * x5^2.

Let sigma6 (x0 x1 x2 x3 x4 x5 : R) :=
  755071587774655/1125899906842624 + -2545503186441449/36028797018963968 * 
  x0 + -6548602598422217/72057594037927936 * x1
  + -1352729369981235/18014398509481984 * x2
  + -5935987291716423/72057594037927936 * x3
  + -6304869714371519/72057594037927936 * x4
  + 7274732626275081/18014398509481984 * x5
  + 3069320011327869/4503599627370496 * x0^2
  + -1690039139965335/9007199254740992 * x0 * x1
  + 6026035745681547/9007199254740992 * x1^2
  + -3821579921489961/288230376151711744 * x0 * x2
  + -2203596662548551/576460752303423488 * x1 * x2
  + 6187271160608045/9007199254740992 * x2^2
  + -5265079497679167/288230376151711744 * x0 * x3
  + -7648850446704655/72057594037927936 * x1 * x3
  + 5717852857190555/1152921504606846976 * x2 * x3
  + 6178452145196991/9007199254740992 * x3^2
  + -4507653559690065/36028797018963968 * x0 * x4
  + -8909981516041673/576460752303423488 * x1 * x4
  + -1308703761151379/288230376151711744 * x2 * x4
  + -1443378907798213/9007199254740992 * x3 * x4
  + 378896014468601/562949953421312 * x4^2
  + -2885794407724403/9007199254740992 * x0 * x5
  + -2711233185067597/9007199254740992 * x1 * x5
  + -172876125699383/562949953421312 * x2 * x5
  + -2573361834025963/9007199254740992 * x3 * x5
  + -5320225347144595/18014398509481984 * x4 * x5
  + 8501493214453841/9007199254740992 * x5^2.

Lemma relax_pos (x0 x1 x2 x3 x4 x5 : R) :
  sigma x0 x1 x2 x3 x4 x5 * p x0 x1 x2 x3 x4 x5
  - sigma1 x0 x1 x2 x3 x4 x5 * b1 x0 x1 x2 x3 x4 x5
  - sigma2 x0 x1 x2 x3 x4 x5 * b2 x0 x1 x2 x3 x4 x5
  - sigma3 x0 x1 x2 x3 x4 x5 * b3 x0 x1 x2 x3 x4 x5
  - sigma4 x0 x1 x2 x3 x4 x5 * b4 x0 x1 x2 x3 x4 x5
  - sigma5 x0 x1 x2 x3 x4 x5 * b5 x0 x1 x2 x3 x4 x5
  - sigma6 x0 x1 x2 x3 x4 x5 * b6 x0 x1 x2 x3 x4 x5 > 0.
Proof.
rewrite /sigma /p /sigma1 /b1 /sigma2 /b2 /sigma3 /b3 /sigma4 /b4 /sigma5 /b5 /sigma6 /b6.
validsdp.
Qed.

Lemma sigma_pos (x0 x1 x2 x3 x4 x5 : R) : sigma x0 x1 x2 x3 x4 x5 > 0.
Proof. rewrite /sigma. interval. Qed.

Lemma sigma1_pos (x0 x1 x2 x3 x4 x5 : R) : sigma1 x0 x1 x2 x3 x4 x5 >= 0.
Proof. rewrite /sigma1. validsdp. Qed.

Lemma sigma2_pos (x0 x1 x2 x3 x4 x5 : R) : sigma2 x0 x1 x2 x3 x4 x5 >= 0.
Proof. rewrite /sigma2. validsdp. Qed.

Lemma sigma3_pos (x0 x1 x2 x3 x4 x5 : R) : sigma3 x0 x1 x2 x3 x4 x5 >= 0.
Proof. rewrite /sigma3. validsdp. Qed.

Lemma sigma4_pos (x0 x1 x2 x3 x4 x5 : R) : sigma4 x0 x1 x2 x3 x4 x5 >= 0.
Proof. rewrite /sigma4. validsdp. Qed.

Lemma sigma5_pos (x0 x1 x2 x3 x4 x5 : R) : sigma5 x0 x1 x2 x3 x4 x5 >= 0.
Proof. rewrite /sigma5. validsdp. Qed.

Lemma sigma6_pos (x0 x1 x2 x3 x4 x5 : R) : sigma6 x0 x1 x2 x3 x4 x5 >= 0.
Proof. rewrite /sigma6. validsdp. Qed.

Lemma var_bounds (x l u : R) : l <= x <= u -> (x - l) * (u - x) >= 0.
Proof.
move=> [Hl Hu].
apply Rle_ge.
by apply Interval_missing.Rmult_le_pos_pos; apply Fcore_Raux.Rle_0_minus.
Qed.

Lemma relax (x y z : R) : x >= 0 -> y >= 0 -> z - x * y > 0 -> z > 0.
Proof.
move=> HX Hy.
apply Rge_gt_trans, Rle_ge.
rewrite -{2}(Rminus_0_r z).
apply Rplus_le_compat_l, Ropp_le_contravar.
by apply Interval_missing.Rmult_le_pos_pos; apply Rge_le.
Qed.
  
Theorem p_pos (x0 x1 x2 x3 x4 x5 x6 : R) :
  606887582536 / 100000000000 <= x0 <= 702674064 / 100000000 ->
  4 <= x1 <= 8 ->
  4 <= x2 <= 8 ->
  4 <= x3 <= 8 ->
  4 <= x4 <= 8 ->
  4 <= x5 <= 8 ->
  p x0 x1 x2 x3 x4 x5 > 0.
Proof.
move=> H1 H2 H3 H4 H5 H6.
have Hb0 : b1 x0 x1 x2 x3 x4 x5 >= 0.
{ by apply var_bounds. }
have Hb1 : b2 x0 x1 x2 x3 x4 x5 >= 0.
{ by apply var_bounds; rewrite !Rcomplements.Rdiv_1. }
have Hb2 : b3 x0 x1 x2 x3 x4 x5 >= 0.
{ by apply var_bounds; rewrite !Rcomplements.Rdiv_1. }
have Hb3 : b4 x0 x1 x2 x3 x4 x5 >= 0.
{ by apply var_bounds; rewrite !Rcomplements.Rdiv_1. }
have Hb4 : b5 x0 x1 x2 x3 x4 x5 >= 0.
{ by apply var_bounds; rewrite !Rcomplements.Rdiv_1. }
have Hb5 : b6 x0 x1 x2 x3 x4 x5 >= 0.
{ by apply var_bounds; rewrite !Rcomplements.Rdiv_1. }
apply (Rmult_lt_reg_l (sigma x0 x1 x2 x3 x4 x5)); [by apply sigma_pos|].
rewrite Rmult_0_r.
apply (relax _ _ _ (sigma1_pos x0 x1 x2 x3 x4 x5) Hb0).
apply (relax _ _ _ (sigma2_pos x0 x1 x2 x3 x4 x5) Hb1).
apply (relax _ _ _ (sigma3_pos x0 x1 x2 x3 x4 x5) Hb2).
apply (relax _ _ _ (sigma4_pos x0 x1 x2 x3 x4 x5) Hb3).
apply (relax _ _ _ (sigma5_pos x0 x1 x2 x3 x4 x5) Hb4).
apply (relax _ _ _ (sigma6_pos x0 x1 x2 x3 x4 x5) Hb5).
apply relax_pos.
Qed.
